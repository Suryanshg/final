<!DOCTYPE html>

<script src="https://d3js.org/d3.v6.min.js"></script>

<html>

	<head>
		<link rel="stylesheet" href="styles.css" />
	</head>

    <body>
        <svg id="vis"></svg>
		<div class="tooltip">
			<div>
				<a></a>
				<span></span>
			</div>
		</div>
    </body>

</html>

<script>
	console.log(d3);

	var margin = {
        left: 60,
        top: 10,
        right: 10,
        bottom: 10
    };

    var height = 480 - margin.top - margin.bottom;
    var width = 640 - margin.left - margin.right;

    var svg = d3.select('#vis')
		.style('width', width + margin.left + margin.right)
		.style('height', height + margin.top + margin.bottom);
	
	var file = 'testData.json';
	
	var generateChart = data => {
		var bubble = data => d3.pack()
			.size([width, height])
			.padding(2)(d3.hierarchy({ children: data }).sum(d => d.score));
			
		var root = bubble(data);
		var tooltip = d3.select('.tooltip');
			
		var node = svg.selectAll()
			.data(root.children)
			.enter().append('g')
			.attr('transform', d => `translate(${d.x}, ${d.y})`);
			
		var circle = node.append('circle')
			.attr('r', d => d.r)
			.style('fill', 'orange')
			.on('mouseover', function (e, d){
				tooltip.select('a').attr('href', d.data.link).text(d.data.name);
				tooltip.select('span').attr('class', d.data.category).text(d.data.category);
				tooltip.style('visibility', 'visible');
				
				d3.select(this).style('stroke', '#222');
			})
			.on('click', (e, d) => window.open(d.data.link))
			.on('mousemove', e => tooltip.style('top', `${e.pageY}px`)
										 .style('left', `${e.pageX + 10}px`));
			
		var label = node.append('text')
			.attr('dy', 2)
			.text(d => d.data.name.substring(0, d.r / 3));
	
	}
	
	(async () => {
		data = await d3.json(file).then(data => data);
		generateChart(data);
	})();

</script>