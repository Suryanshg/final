<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CS480X datavis final project</title>
</head>
<body>
    <h1>Exploring Medicine Side Effects with d3</h1>
    <h2>Most common side effects</h2>
    <svg id="Bubbles"></svg>
    Text description
    <h2>Explore drugs by their side effects</h2>
    <svg id="Bar"></svg>
    Text description
    <h2>Explore the side effects of a certain drug</h2>
    <svg id="Lolipop"></svg>
    Text description
    <svg id="transition"></svg><br><br>
    <button onclick="nextLevel()">Next Level</button>
    <button onclick="prevLevel()">Previous Level</button>
</body>
</html>

<script src="https://d3js.org/d3.v6.min.js"></script>

<script>

    topSvg = d3.select('#transition')
    .style('height', 460)
    .style('width', 400);

    //these can be renamed
    g1 = topSvg.append('g').attr('opacity', 1);
    g2 = topSvg.append('g').attr('opacity', 0);
    g3 = topSvg.append('g').attr('opacity', 0);

    g1.append('text')
    .attr('x', 400/2)
    .attr('y', 460/2)
    .text('one')
    .attr('fill', 'black')

    g2.append('text')
    .attr('x', 400/2 + 20)
    .attr('y', 460/2 + 20)
    .text('two')
    .attr('fill', 'black')

    g3.append('text')
    .attr('x', 400/2 + 40)
    .attr('y', 460/2 + 40)
    .text('three')
    .attr('fill', 'black')

    groupCursor = 0;
    svgGroups = [g1, g2, g3];

    function nextLevel() {

        if(groupCursor == svgGroups.length - 1) {
            return;
        }

        let current = svgGroups[groupCursor];

        //fade out the current level.

        current.transition()
        .duration(500)
        .attr('opacity', 0);
        current.attr('pointer-events', 'none');

        //fade in the next level.
        groupCursor += 1;
        current = svgGroups[groupCursor];

        current.attr('pointer-events', 'auto');
        
        current.transition()
        .duration(500)
        .attr('opacity', 1);

    }

    function prevLevel() {

        if(groupCursor == 0) {
            return;
        }

        let current = svgGroups[groupCursor];

        //fade out the current level.

        current.transition()
        .duration(500)
        .attr('opacity', 0);
        current.attr('pointer-events', 'none');

        //fade in the previous level.
        groupCursor -= 1;
        current = svgGroups[groupCursor];

        current.attr('pointer-events', 'auto');

        current.transition()
        .duration(500)
        .attr('opacity', 1);

    }

    async function printSideEffects() {

        let masterData = await d3.tsv('master.tsv');
        //console.log(data);
        let sideEffects = new Set();

        for(d of masterData) {

            sideEffects.add(d.SideEffectName);

        }

        console.log(sideEffects);

    }

    async function printSideEffectsMap() {

        let masterData = await d3.tsv('master.tsv');

        let seMap = new Map();

        for(d of masterData) {

            if(seMap.has(d.SideEffectName)) {
                seMap.set(d.SideEffectName, seMap.get(d.SideEffectName) + 1);
            } else {
                seMap.set(d.SideEffectName, 1);
            }

        }

        console.log(seMap);

    }

</script>