<!DOCTYPE html>
<meta charset="utf-8">

<script src="https://d3js.org/d3.v4.js"></script>

<div id="barChart"></div>

<script>


    // setting the dimensions and margins of the bar chart
    var margin = {top: 30, right: 30, bottom: 60, left: 60},
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;
    
    // appending the svg 
    var svg = d3.select("#barChart")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)

    // adjusting the position of svg
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
    
    // parsing the data
    d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/7_OneCatOneNum_header.csv", function(data) {
    
      // sort the data in descending order 
      data.sort(function(b, a) {
        return a.Value - b.Value;
      });
    
      // adding x-axis
      var x = d3.scaleBand()
        .range([ 0, width ])
        .domain(data.map(function(d) { return d.Country; }))
        .padding(0.2);
      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x))
        .selectAll("text")
          .attr("transform", "translate(0,0)rotate(-45)")
          .style("text-anchor", "end");
    
      // adding y-axis
      var y = d3.scaleLinear()
        .domain([0, 13000])
        .range([ height, 0]);
      svg.append("g")
        .call(d3.axisLeft(y));
    
      // add bars
      svg.selectAll("mybar")
        .data(data)
        .enter()
        .append("rect")
          .attr("x", function(d) { return x(d.Country); })
          .attr("y", function(d) { return y(d.Value); })
          .attr("width", x.bandwidth())
          .attr("height", function(d) { return height - y(d.Value); })
          .attr("fill", "white")
          .attr('stroke',"black")
    
    })
    
    </script>

    <script>
      d3.tsv("master.tsv",function(data){

        var targetDrug = "18F-flutemetamol"
        var targetSideEffect = "Depression"
        data.forEach(function(d) {
          d.MeanFrequency = +d.MeanFrequency;
          d.MinFrequency = +d.MinFrequency;
          d.MaxFrequency = +d.MaxFrequency;
        });

        //console.log(data)

        v = data.filter(function(d){
          return d.SideEffectName == targetSideEffect
        })

        v.sort(function(a, b) {
          return b.MeanFrequency - a.MeanFrequency
        })

        // Top 20 drugs with depression side effect
        v = v.slice(0,20)
        console.log(v)
      })
    </script>