<!DOCTYPE html>
<meta charset="utf-8">

<script src="https://d3js.org/d3.v6.min.js"></script>

<div id="barChart"></div>

<script>


    // setting the dimensions and margins of the bar chart
    var margin = {top: 30, right: 30, bottom: 60, left: 60},
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;
    
    // appending the svg 
    var svg = d3.select("#barChart")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)

    // adjusting the position of svg
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
    
    // parsing the data
    d3.tsv("master.tsv").then(function(data) {

      // Converting the string fields to numeric vals
      data.forEach(function(d) {
        d.MeanFrequency = +d.MeanFrequency;
        d.MinFrequency = +d.MinFrequency;
        d.MaxFrequency = +d.MaxFrequency;
      })

      var targetSideEffect = "Depression" // level 2

      // Filtering by side effect - level 2
      var filteredDrugs = data.filter(d => d.SideEffectName == targetSideEffect)

      filteredDrugs.sort(function(a, b) {
        return b.MeanFrequency - a.MeanFrequency
      })

      filteredDrugs = filteredDrugs.slice(0,20)

      console.log(filteredDrugs)
    
      // adding x-axis
      var x = d3.scaleBand()
        .range([ 0, width ])
        .domain(filteredDrugs.map(function(d) { return d.Name; }))
        .padding(0.2);
      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x))
        .selectAll("text")
          .attr("transform", "translate(0,0)rotate(-45)")
          .style("text-anchor", "end");
    
      // adding y-axis
      var y = d3.scaleLinear()
        .domain([0, 1])
        .range([ height, 0]);
      svg.append("g")
        .call(d3.axisLeft(y));
    
      // add bars
      svg.selectAll("mybar")
        .data(filteredDrugs)
        .enter()
        .append("rect")
          .attr("x", function(d) { 
            return x(d.Name); 
          })
          .attr("y", function(d) { 
            return y(d.MeanFrequency); 
          })
          .attr("width", x.bandwidth())
          .attr("height", function(d) { return height - y(d.MeanFrequency); })
          .attr("fill", "steelblue")
          .attr('stroke',"black")
    
    })
    
    </script>

    <script>
      d3.tsv("master.tsv").then(function(data){

        var targetDrug = "18F-flutemetamol" // level 3
        var targetSideEffect = "Depression" // level 2
        
        // Converting the string fields to numeric vals
        data.forEach(function(d) {
          d.MeanFrequency = +d.MeanFrequency;
          d.MinFrequency = +d.MinFrequency;
          d.MaxFrequency = +d.MaxFrequency;
        })

        //console.log(data)

        // Filtering by drug - level 3
        var filteredSideEffects = data.filter(d => d.Name == targetDrug)

        filteredSideEffects.sort(function(a, b) {
          return b.MeanFrequency - a.MeanFrequency
        })
      
        filteredSideEffects = filteredSideEffects.slice(0,20)
        //console.log(filteredSideEffects)   // Top 20 side effects of the target Drug



        // Filtering by side effect - level 2
        var filteredDrugs = data.filter(d => d.SideEffectName == targetSideEffect)

        filteredDrugs.sort(function(a, b) {
          return b.MeanFrequency - a.MeanFrequency
        })

        filteredDrugs = filteredDrugs.slice(0,20)
        //console.log(filteredDrugs) // Top 20 drugs with target Side effect
      })
    </script>